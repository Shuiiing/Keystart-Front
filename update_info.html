<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/signStyle.css" />
    <link rel="stylesheet" href="css/mobileSignStyle.css" />

    <title>정보 수정</title>
    <style>
        /* CSS는 여기에 추가됩니다 */
    </style>
</head>
<div class="TopNav">
    <!-- 네비바 로고영역 -->
    <!-- <div class="logo-top">
    <img src="./img/logo/logoBlack.png" alt="" />
  </div> -->

    <!-- 네비바 중간영역 -->
    <div class="main-nav">
        <div>
            <a href="#keystart" class="nav-link">키스타트란?</a>
        </div>
        <div>
            <a href="#partners" class="nav-link">파트너사</a>
        </div>
        <div>
            <a href="#stories" class="nav-link">창업 이야기</a>
        </div>
        <div>
            <a href="#info" class="nav-link">창업 관련 정보</a>
        </div>
    </div>
</div>

<body>
    <div>
        <div class="mainSign">
            <div class="logo">
                <img src="./img/logo/logoBlack.png" alt="" />
            </div>
            <div class="signText">회원가입</div>
        </div>
    </div>

    <div class="binding">
        <!-- 이름 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">이름</span>
                <span class="required">*</span>
            </div>
            <input type="text" name="name" class="placeholder placeholder-field" placeholder="최소 2자 이상 입력" required
                readonly />
        </div>

        <!-- 이메일 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">이메일</span>
                <span class="required">*</span>
            </div>
            <input type="email" name="email" class="placeholder placeholder-field"
                placeholder="예시: keystart@keystart.co.kr" required readonly />
        </div>

        <!-- 휴대폰 번호 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">휴대폰 번호</span>
                <span class="required">*</span>
            </div>
            <input type="text" name="tel" class="placeholder placeholder-field" placeholder="'-' 없이 번호만 입력" required
                readonly />
        </div>

        <!-- 생년 월일 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">생년 월일</span><span class="required">*</span>
            </div>
            <div class="date-collection">
                <div class="date-wrapper">
                    <input type="text" class="calender-year" id="calenderYear" placeholder="YYYY" readonly />
                    <span class="date-label">년</span>
                </div>
                <div class="date-wrapper">
                    <input type="text" class="calender-month" id="calenderMonth" placeholder="MM" readonly />
                    <span class="date-label">월</span>
                </div>
                <div class="date-wrapper">
                    <input type="text" class="calender-day" id="calenderDay" placeholder="DD" readonly />
                    <span class="date-label">일</span>
                </div>
            </div>
        </div>

        <!-- 연령대 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">연령대</span>
                <span class="required">*</span>
            </div>
            <input type="text" name="age" class="placeholder placeholder-field" placeholder="연령대 입력" required
                readonly />
        </div>

        <!-- 성별 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">성별</span>
                <span class="required">*</span>
            </div>
            <input type="text" name="gender" class="placeholder placeholder-field" placeholder="성별 입력" required
                readonly />
        </div>

        <!-- 창업 유무  -->
        <div class="create-store">
            <div class="label">
                <span class="label-text">창업 유무</span>
                <span class="required">*</span>
            </div>
            <div class="radio-layout">
                <label class="radio-option">
                    <input type="radio" name="startup" value="preparatory" checked />
                    예비창업자
                </label>
                <label class="radio-option">
                    <input type="radio" name="startup" value="existing" />
                    기존창업자
                </label>
            </div>
        </div>

        <!-- 관심 카테고리 -->
        <div class="category">
            <div>관심 카테고리 (중복선택가능)</div>
            <div class="checkbox-group">
                <label class="checkbox-option">
                    <input type="checkbox" name="interest" value="cafe" class="custom-checkbox" />
                    카페
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="interest" value="restaurant" class="custom-checkbox" />
                    음식점
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="interest" value="pub" class="custom-checkbox" />
                    주점
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="interest" value="unmanned" class="custom-checkbox" />
                    무인 창업
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="interest" value="other" class="custom-checkbox" />
                    기타
                </label>
            </div>
        </div>

        <!-- 추천인 코드 -->
        <div class="textfield">
            <div class="label">
                <span class="label-text">추천인 코드</span>
            </div>
            <input type="text" name="referralCode" class="placeholder placeholder-field" placeholder="추천인 코드 입력"
                required />
        </div>

        <!-- 이용약관 동의 -->
        <div class="mmar m1">
            <div class="agreement">
                <label class="checkbox-option">
                    <input type="checkbox" name="terms" value="terms" class="custom-checkbox" />
                    이용약관 동의
                    <span class="required">*</span>
                </label>
            </div>
            <div>
                <a href="#" class="agreement-link">내용 보기</a>
            </div>
        </div>

        <!-- 개인정보 수집 및 이용 동의 -->
        <div class="mmar">
            <div class="agreement">
                <label class="checkbox-option">
                    <input type="checkbox" name="personalinfor" value="personalinfor" class="custom-checkbox" />
                    개인정보 수집 및 이용 동의
                    <span class="required">*</span>
                </label>
            </div>
            <div>
                <a href="#" class="agreement-link">내용 보기</a>
            </div>
        </div>

        <div>
            <button class="button-sign" id="submit-button">수정완료</button>
        </div>
    </div>

    <div class="withdraw">
        <div class="withdraw-info">탈퇴 안내</div>
        <div class="withdraw-content">탈퇴 전 아래의 안내 사항을 확인해 주세요.</div>
        <div class="withdraw-del"> • 탈퇴 후 개인정보는 모두 삭제합니다.</div>
        <div class="withdraw-profile">
            <div>프로필 정보</div>
            <div></div>
            <div>이메일 주소, 이름, 휴대폰 번호, 생년월일, 연령대, 성별 정보 삭제</div>
        </div>
        <div class="withdraw-del"> • 탈퇴 후 개인정보는 모두 삭제합니다.</div>
        <div class="withdraw-profile">
            <div>창업이야기</div>
            <div class="withdraw-profile-after">회원이 동의한 창업 관련 후기 내용 및 해당 업체 사진 정보 유지</div>
        </div>
        <div class="agreement">
            <label class="checkbox-option">
                <input type="checkbox" name="terms" value="terms" class="custom-checkbox" />
                안내사항 모두 확인, 동의합니다.
                <span class="required">*</span>
            </label>
        </div>
        <div>
            <button class="button-withdraw" id="submit-button">회원탈퇴</button>
        </div>
    </div>

    <div class="footer">
        <div class="footer-left">
            <div class="contents">
                <div class="text-wrapper">이용약관</div>
                <div class="div">ㅣ</div>
                <div class="text-wrapper">개인정보 처리방침</div>
            </div>
            <div class="contents-2">
                <div class="text">
                    <div class="view">
                        <div class="text-wrapper-2">상호명</div>
                        <div class="text-wrapper">키스타트</div>
                    </div>
                    <div class="text-wrapper-2">ㅣ</div>
                    <div class="view">
                        <div class="text-wrapper-2">주소</div>
                        <div class="text-wrapper">
                            울산광역시 중구 운곡8길 82-2, 201호 (다운동)
                        </div>
                    </div>
                </div>
                <div class="text">
                    <div class="view">
                        <div class="text-wrapper-2">사업자등록번호</div>
                        <div class="text-wrapper">607-79-00239 [사업자 정보 확인]</div>
                    </div>
                </div>
                <div class="text">
                    <div class="view">
                        <div class="text-wrapper-2">E-MAIL</div>
                        <div class="text-wrapper">keystart@keystart.co.kr</div>
                    </div>
                    <div class="text-wrapper-2">ㅣ</div>
                    <div class="view">
                        <div class="text-wrapper-2">TEL</div>
                        <div class="text-wrapper">010-9043-9908</div>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <script>
        //데이터 가져오고 보이기
        function displayUserInfo(data) {
            document.querySelector('[name="name"]').value = data.name;
            document.querySelector('[name="email"]').value = data.email;
            const formattedHpNo = data.hpNo.replace("+82 ", "0");
            document.querySelector('[name="tel"]').value = formattedHpNo;
            document.querySelector('[name="age"]').value = data.ageRange;
            document.querySelector('[name="gender"]').value =
                data.gender === "male" ? "남자" : "여자";
            document.getElementById("calenderYear").value = data.birthyear;
            document.getElementById("calenderMonth").value =
                data.birthday.substring(0, 2);
            document.getElementById("calenderDay").value = data.birthday.substring(
                2,
                4
            );
        }

        // 데이터 정보가져오는 코드
        async function fetchUserInfo() {
            try {
                // localStorage에서 토큰을 가져옵니다.
                const token = localStorage.getItem("accessToken");
                console.log(token);
                if (!token) {
                    console.log("토큰이 없습니다. 로그인이 필요합니다.");
                    return;
                }

                const response = await fetch(
                    "http://localhost:8282/api/v1/user/info",
                    //"https://www.keystart.co.kr/api/v1/user/info",
                    {
                        method: "GET",
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    }
                );

                if (!response.ok) {
                    throw new Error("사용자 정보를 불러오는데 실패했습니다.");
                }

                const data = await response.json();
                console.log("사용자 정보:", data); // 콘솔에 사용자 정보 출력
                displayUserInfo(data); // 사용자 정보 화면에 표시
            } catch (error) {
                console.error("사용자 정보 요청 중 오류 발생:", error);
            }
        }

        //데이터 보내기 저장 회원가입 완료
        document
            .getElementById("submit-button")
            .addEventListener("click", async function (e) {
                e.preventDefault(); // 폼 기본 제출 방지

                // 창업 유무
                const userType = document.querySelector(
                    'input[name="startup"]:checked'
                ).value;

                // 추천인 코드
                const referralCode = document.querySelector(
                    'input[name="referralCode"]'
                ).value;

                // 관심 카테고리
                const category = Array.from(
                    document.querySelectorAll('input[name="interest"]:checked')
                ).map((el) => el.value);

                // 데이터 객체 생성
                const updateData = {
                    userType,
                    referralCode,
                    category,
                };
                const token = localStorage.getItem("accessToken");

                // Fetch API를 사용하여 서버에 데이터 전송
                try {
                    const response = await fetch(
                        "http://localhost:8282/api/v1/user/updateUser",
                        //"https://www.keystart.co.kr/api/v1/user/updateUser",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                // 필요한 경우 인증 토큰 추가
                                Authorization: `Bearer ${token}`,
                            },
                            body: JSON.stringify(updateData),
                        }
                    );

                    if (!response.ok)
                        throw new Error("Failed to update user information");

                    const result = await response.json();
                    console.log("Update success:", result);
                    //location.href = "https://www.keystart.co.kr/index.html";
                    location.href = "http://127.0.0.1:5500/index.html";
                } catch (error) {
                    console.error("Error updating user information:", error);
                }
            });

        // 웹 페이지 로드 완료 시 사용자 정보 요청
        window.onload = function () {
            fetchUserInfo();
        };

        // -----------------  스크롤을 내렸을때 글씨가 바뀌는 작업  -----------------

        // 스크롤을 내렸을때 글씨가 바뀌는 작업
        window.addEventListener("scroll", function () {
            var navbar = document.querySelector(".TopNav");
            if (window.scrollY > 0) {
                navbar.classList.add("scrolled");
            } else {
                navbar.classList.remove("scrolled");
            }
        });

        window.addEventListener("scroll", function () {
            var navbar = document.querySelector(".TopNav");
            var logoImg = document.querySelector(".logo-top img");

            if (window.scrollY > 0) {
                navbar.classList.add("scrolled");
                logoImg.src = "./img/logo/top-white-logo.png";
            } else {
                navbar.classList.remove("scrolled");
                logoImg.src = "./img/logo/logoBlack.png";
            }
        });

        // -----------------  스크롤을 내렸을때 글씨가 바뀌는 작업  -----------------
    </script>
</body>

</html>